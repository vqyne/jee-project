<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les sessions - Paris 2024</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/map.css">
    <link rel="icon" href="./img/paris.ico" type="image/x-icon">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        function assignIcon(category){
            switch(category){
                case 'stade':
                    return 'category/stadium.png'
                case 'salle_de_spectacle':
                    return 'category/spectacle.png'
                case 'lieu_public':
                    return 'category/public.png'
                case 'centre_aquatique':
                    return 'category/pool.png'
                case 'salle':
                    return 'category/salle.png'
                case 'gymnase':
                    return 'category/gymnase.png'
                case 'golf':
                    return 'category/golf.png'
            }
        }
    </script>
    <style>
        #map {
            height: 100vh;
            width: 100vw;
        }
    </style>
</head>

<body class="body">
    <nav id="nav" class="bg-white dark:bg-gray-900 sticky w-full z-20 top-0 left-0 border-b-2">
        <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
            <a class="flex items-center">
                <img src="./img/paris2.png" class="h-16 mr-2" alt="Paris OG Logo">
                <span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">Session Map</span>
            </a>
            <div class="flex md:order-2">
                <button onclick="window.location.href='admin.html';" type="button"
                    class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 text-center mr-3 md:mr-0 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Admin</button>
                <button data-collapse-toggle="navbar-sticky" type="button"
                    class="inline-flex items-center p-2 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
                    aria-controls="navbar-sticky" aria-expanded="false">
                    <span class="sr-only">Open main menu</span>
                    <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd"
                            d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                            clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            <div class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1" id="navbar-sticky">
                <ul
                    class="flex flex-col p-4 md:p-0 mt-4 font-medium border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">
                    <li>
                        <a href="/jee-project/athlete.html"
                            class="block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Athlètes</a>
                    </li>
                    <li>
                        <a href=""
                            class="block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Sessions</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div id="map" class="z-10"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.4/flowbite.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Initialize the map
            var map = L.map("map").setView([48.8566, 2.3522], 10);

            // Add a tile layer for the map
            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
                attribution: "Map data © <a href='https://openstreetmap.org'>OpenStreetMap</a> contributors",
                maxZoom: 18,
            }).addTo(map);

            // Fetch sessions data and create markers
            fetch("/jee-project/api/session-controller/get-sessions")
                .then((response) => response.json())
                .then((sessions) => {
                    sessions.forEach(function (session) {
                        // Geocode the session location using Mapbox Geocoding API
                        var location = session.site.name + ", Paris"; // Update with the appropriate location field from your data

                        fetch(
                            "https://api.mapbox.com/geocoding/v5/mapbox.places/" +
                            encodeURIComponent(location) +
                            ".json?access_token=pk.eyJ1Ijoia3JvbmVja2VyIiwiYSI6ImNsaG5qeW5vYzFuN24zaHFwZjg4b2c0ZTkifQ.eA48E0drQ_DRl-smLCiBRg"
                        )
                            .then((response) => response.json())
                            .then((data) => {
                                if (data.features.length > 0) {
                                    console.log(data)
                                    var coordinates = data.features[0].center;
                                    var latitude = coordinates[1];
                                    var longitude = coordinates[0];

                                    // Create a custom icon
                                    var customIcon = L.icon({
                                    iconUrl: assignIcon(session.site.category),
                                    iconSize: [32, 32],
                                    });

                                    // Create a marker with the custom icon
                                    var marker = L.marker([latitude, longitude], { icon: customIcon }).addTo(map);
                                    marker.bindPopup(
                                        "<div style='text-align: center;'>" +
                                        "<b>" + session.code + "</b><br>" +
                                        "<span style='display: block;'>" + session.description + "</span>" +
                                        "<span style='display: block;'>" + session.site.name + ", " + session.site.city + "</span>" +
                                        "<span style='display: block;'>" + session.date + "</span>" +
                                        "<span style='display: block;'>" + session.fromHour + " - " + session.toHour + "</span>" +
                                        "</div>"
                                    );
                                }
                            })
                            .catch((error) => console.error("Error: " + error));
                    });
                })
                .catch((error) => alert("Error: " + error));
        });
    </script>

</body>

</html>