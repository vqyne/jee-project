<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Paris 2024 | Sites</title>
	<link rel="stylesheet" href="/jee-project/css/styles.css">
	<link rel="icon" href="/jee-project/img/paris.ico" type="image/x-icon">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.4/flowbite.min.css" rel="stylesheet" />
	<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet" />
	
	<script>
		function loadSite(url) {
			fetch(url)
			.then(response => response.json())
			.then(response => process(response))
			.catch(error => console.log("Erreur : " + error));
		}
		
		function process(sites) {
	
			var table = document.getElementById("tbody-site");
			
		    while (table.childElementCount > 0) {
		        table.removeChild(table.lastChild);
		    }
		    			
			for (var s of sites) {
				var tr = document.createElement("tr");
				tr.classList.add('bg-white', 'border-b', 'dark:bg-gray-800', 'dark:border-gray-700');
				
				var td_id = document.createElement("th");
				td_id.append(s.id)
				td_id.classList.add('px-6', 'py-4', 'font-medium', 'text-gray-900', 'whitespace-nowrap', 'dark:text-white')
				td_id.setAttribute("scope", "col"); 
				
				var td_name = document.createElement("th");
				td_name.append(s.name)
				td_name.classList.add('px-6', 'py-4', 'font-medium', 'text-gray-900', 'whitespace-nowrap', 'dark:text-white')
				td_name.setAttribute("scope", "col"); 
				
				var td_city = document.createElement("th");				
				td_city.append(s.city)
				td_city.classList.add('px-6', 'py-4', 'font-medium', 'text-gray-900', 'whitespace-nowrap', 'dark:text-white')
				td_city.setAttribute("scope", "col"); 
				
				var td_categorie = document.createElement("th");
				td_categorie.append(s.category)
				td_categorie.classList.add('px-6', 'py-4', 'font-medium', 'text-gray-900', 'whitespace-nowrap', 'dark:text-white')
				td_categorie.setAttribute("scope", "col"); 
				
				var td_modify = document.createElement("th");
				
				var editIcon = document.createElement("img");
				editIcon.setAttribute("alt", "");
				editIcon.setAttribute("width", "24");
				editIcon.setAttribute("height", "24");
				editIcon.setAttribute("src", "/jee-project/img/edit.svg"); 
				td_modify.classList.add("edit-class")
				td_modify.setAttribute("id","edit-icon-"+s.id)
				
				td_modify.append(editIcon)
				td_modify.classList.add('px-6', 'py-4', 'font-medium', 'text-gray-900', 'whitespace-nowrap', 'dark:text-white')
				td_modify.setAttribute("scope", "col"); 
				
				td_modify.addEventListener('click',function(){
					const currentURL = window.location.href;
					const projectUrl = currentURL.split("/jee-project")[0];
					const newURL = projectUrl + "/jee-project/admin/site/modify.html";
					window.open(newURL, "_blank");
				})
				
				var td_delete = document.createElement("th");
				
				var deleteIcon = document.createElement("img");
				deleteIcon.setAttribute("alt", "");
				deleteIcon.setAttribute("width", "24");
				deleteIcon.setAttribute("height", "24");
				deleteIcon.setAttribute("src", "/jee-project/img/trash.svg"); 
				td_delete.classList.add("delete-class")
				td_delete.setAttribute("id","delete-icon-"+s.id)
				
				td_delete.append(deleteIcon)
				td_delete.classList.add('px-6', 'py-4', 'font-medium', 'text-gray-900', 'whitespace-nowrap', 'dark:text-white')
				td_delete.setAttribute("scope", "col"); 
				
				td_delete.addEventListener('click',function(){
					console.log("modify")
				})
				
				tr.appendChild(td_id);
				tr.appendChild(td_name);
				tr.appendChild(td_city);
				tr.appendChild(td_categorie);
				tr.appendChild(td_modify);
				tr.appendChild(td_delete);

				table.appendChild(tr);
			}
		}
	
	</script>
</head>

<body class="body" onload="loadSite('/jee-project/api/site-controller/get-sites')">
	<header>
		<nav class="bg-white dark:bg-gray-900 sticky w-full z-20 top-0 left-0 border-b border-gray-200 dark:border-gray-600">
			<div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
				<a class="flex items-center">
					<img id="paris_logo" src="/jee-project/img/paris2.png" class="h-16 mr-2" alt="Paris OG Logo">
					<span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">Paris 2024</span>
				</a>
				<div class="flex md:order-2">
				<button onclick="window.location.href='/jee-project/admin/index.html';" type="button"
						class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 text-center mr-3 md:mr-0 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Admin</button>
					<button data-collapse-toggle="navbar-sticky" type="button"
						class="inline-flex items-center p-2 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
						aria-controls="navbar-sticky" aria-expanded="false">
						<span class="sr-only">Open main menu</span>
						<svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
							xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd"
								d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
								clip-rule="evenodd"></path>
						</svg>
					</button>
				</div>
				<div class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1" id="navbar-sticky">
					<ul
						class="flex flex-col p-4 md:p-0 mt-4 font-medium border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">

						<li>
							<a href="/jee-project/admin/discipline/index.html"
								class="block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Disciplines</a>
						</li>
						<li>
							<a href="/jee-project/admin/site/index.html"
								class="block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Sites</a>
						</li>
						<li>
							<a href="/jee-project/admin/session.html"
								class="block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Sessions</a>
						</li>

					</ul>
				</div>
			</div>
		</nav>
	</header>

	<main style="margin-top: 10px" class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
	 
		<form id="add-site-form" class="max-w-sm mx-auto">
		  <div class="mb-4">
		    <label class="block text-gray-700 font-bold mb-2" for="site-name">
		      Site à ajouter
		    </label>
		    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="site-name" type="text" placeholder="Saisissez le nom du site">
		  </div>
		  <div class="mb-4">
		    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="site-city" type="text" placeholder="Saisissez la ville du site">
		  </div>
		  <div class="mb-4">
			<select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="site-category" data-target="categorieList">
			</select>
		  </div>
		  <div class="flex items-center justify-center">
		    <button id="submit-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button">
		      Ajouter
		    </button>
		  </div>
		</form>
		
        <div style="margin-top: 20px" class="w-full overflow-x-auto overflow-y-auto shadow-md sm:rounded-lg z-10">
            <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                <thead
                    class="z-10 text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th scope="col" class="px-6 py-3">
                            Identifiant
                        </th>
                        <th scope="col" class="px-6 py-3">
                            Nom
                        </th>
                        <th scope="col" class="px-6 py-3">
                            Ville
                        </th>
                        <th scope="col" class="px-6 py-3">
                            Catégorie
                        </th>
                         <th scope="col" class="px-6 py-3">
                            Modifier
                        </th>
                         <th scope="col" class="px-6 py-3">
                            Supprimer
                        </th>
                    </tr>
                </thead>
                <tbody id="tbody-site">
                </tbody>
            </table>
        </div>
    </main>
	
	<span class="dot" id="red"></span>
	<span class="dot" id="blue"></span>
	<span class="dot" id="yellow"></span>
	
	<script>
	
	  const form = document.getElementById('add-site-form');
	  const nameInput = document.getElementById('site-name');
	  const cityInput = document.getElementById('site-city');
	  const categoryInput = document.getElementById('site-category');

	  const submitBtn = document.getElementById('submit-btn');
	  
	  const paris_logo = document.getElementById("paris_logo");
	  paris_logo.addEventListener("click", function(){
	  	window.location.href='/jee-project/';
	  });
	  
	  const selectElement = document.getElementById('site-category');

	  function generateCategoryOptions(categories) {
		  categories.forEach((categorie) => {
		    const optionElement = document.createElement('option');
		    optionElement.value = categorie;
		    optionElement.textContent = categorie;
		    selectElement.appendChild(optionElement);
		  });
	  }
	
	  fetch('/jee-project/api/site-controller/get-categories')
		  .then((response) => response.json())
		  .then((data) => {
		    generateCategoryOptions(data);
		  })
		  .catch((error) => {
		    console.error('Une erreur s\'est produite lors de la récupération des catégories :', error);
	   });


	  submitBtn.addEventListener('click', function(event) {
	    event.preventDefault();
	    
	    const name = nameInput.value;
	    const city = cityInput.value;
	    const category = categoryInput.value;

	    const url = '/jee-project/api/site-controller/site-add';
	    
	    const formData = new URLSearchParams();
	    formData.append('name', name);
	    formData.append('city', city);
	    formData.append('category', category);

	    fetch(url, {
	        method: 'POST',
	        headers: {
	            'Content-Type': 'application/x-www-form-urlencoded'
	          },
	          body: formData
	    })
	    .then(response => {
	      if (!response.ok) {
	    	console.log(response);
	        throw new Error('Error network');
	      }
	      return response.json();
	    })
	    .then(data => {
	      console.log('Site ajouté avec succès:', data);
	      form.reset();
	      loadSite('/jee-project/api/site-controller/get-sites')
	    })
	    .catch(error => {
	      console.error('Erreur lors de l\'ajout de le site:', error);
	    });
	  });
	  
	</script>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.4/flowbite.min.js"></script>
	
</body>
</html>