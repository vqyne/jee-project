<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Paris 2024 | Modification du site</title>
	<link rel="stylesheet" href="/jee-project/css/styles.css">
	<link rel="icon" href="/jee-project/img/paris.ico" type="image/x-icon">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.4/flowbite.min.css" rel="stylesheet" />
	<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet" />
</head>

<body class="body">
	<header>
		<nav class="bg-white dark:bg-gray-900 sticky w-full z-20 top-0 left-0 border-b border-gray-200 dark:border-gray-600">
			<div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
				<a class="flex items-center">
					<img id="paris_logo" src="/jee-project/img/paris2.png" class="h-16 mr-2" alt="Paris OG Logo">
					<span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">Paris 2024</span>
				</a>
				<div class="flex md:order-2">
				<button onclick="window.location.href='/jee-project/admin/index.html';" type="button"
						class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 text-center mr-3 md:mr-0 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Admin</button>
					<button data-collapse-toggle="navbar-sticky" type="button"
						class="inline-flex items-center p-2 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
						aria-controls="navbar-sticky" aria-expanded="false">
						<span class="sr-only">Open main menu</span>
						<svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
							xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd"
								d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
								clip-rule="evenodd"></path>
						</svg>
					</button>
				</div>
				<div class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1" id="navbar-sticky">
					<ul
						class="flex flex-col p-4 md:p-0 mt-4 font-medium border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">

						<li>
							<a href="/jee-project/admin/discipline.html"
								class="block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Disciplines</a>
						</li>
						<li>
							<a href="/jee-project/admin/site.html"
								class="block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Sites</a>
						</li>
						<li>
							<a href="/jee-project/admin/session.html"
								class="block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Sessions</a>
						</li>

					</ul>
				</div>
			</div>
		</nav>
	</header>

	<main style="margin-top: 10px" class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
	 
		<form id="edit-site-form" class="max-w-sm mx-auto">
		  <div class="mb-4">
		    <label class="block text-gray-700 font-bold mb-2" for="site-name">
		      Site à modifier
		    </label>
		    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="site-name" type="text" placeholder="Saisissez le nom du site">
		  </div>
		  <div class="mb-4">
		    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="site-city" type="text" placeholder="Saisissez la ville du site">
		  </div>
		  <div class="mb-4">
			<select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="site-category" data-target="categorieList">
			</select>
		  </div>
		  <div class="flex items-center justify-center">
		    <button id="submit-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button">
		      Modifier
		    </button>
		  </div>
		</form>
    </main>
	
	<span class="dot" id="red"></span>
	<span class="dot" id="blue"></span>
	<span class="dot" id="yellow"></span>
	
	<script>
	
	  const form = document.getElementById('edit-site-form');
	  const nameInput = document.getElementById('site-name');
	  const cityInput = document.getElementById('site-city');
	  const categoryInput = document.getElementById('site-category');

	  const submitBtn = document.getElementById('submit-btn');
	  
	  const paris_logo = document.getElementById("paris_logo");
	  paris_logo.addEventListener("click", function(){
	  	window.location.href='/jee-project/';
	  });
	  
	  const selectElement = document.getElementById('site-category');

	  function generateCategoryOptions(categories) {
		  categories.forEach((categorie) => {
		    const optionElement = document.createElement('option');
		    optionElement.value = categorie;
		    optionElement.textContent = categorie;
		    selectElement.appendChild(optionElement);
		  });
	  }
	
	  fetch('/jee-project/api/site-controller/get-categories')
		  .then((response) => response.json())
		  .then((data) => {
		    generateCategoryOptions(data);
		  })
		  .catch((error) => {
		    console.error('Une erreur s\'est produite lors de la récupération des catégories :', error);
	   });
	  
	  const queryString = window.location.search;
	  const urlParams = new URLSearchParams(queryString);
      const siteId = urlParams.get('id')
	  
	  fetch('/jee-project/api/site-controller/get-site/'+siteId)
			.then((response) => response.json())
			.then((response) => {
				nameInput.value = response.name;
				cityInput.value = response.city;

				for (let i = 0; i < categoryInput.options.length; i++) {
				   const option = categoryInput.options[i];
				   if (option.value === response.category) {
				     option.selected = true;
				     break;
				   }
				 }
			})
			.catch(error => console.log("Erreur : " + error));
	  
	  


	  submitBtn.addEventListener('click', function(event) {
	    event.preventDefault();
	    
	    const name = nameInput.value;
	    const city = cityInput.value;
	    const category = categoryInput.value;

	    const url = '/jee-project/api/site-controller/site-edit';
	    
	    const formData = new URLSearchParams();
	    formData.append('id', siteId);
	    formData.append('name', name);
	    formData.append('city', city);
	    formData.append('category', category);

	    fetch(url, {
	        method: 'PUT',
	        headers: {
	            'Content-Type': 'application/x-www-form-urlencoded'
	          },
	          body: formData
	    })
	    .then(response => {
	      if (!response.ok) {
	    	console.log(response);
	        throw new Error('Error network');
	      }
	      return response.json();
	    })
	    .then(data => {
	      console.log('Site modifié avec succès:', data);
	      form.reset();
	      const currentURL = window.location.href;
		  const projectUrl = currentURL.split("/jee-project")[0];
		  const newURL = projectUrl + "/jee-project/admin/site/index.html";
		  location.replace(newURL);
	    })
	    .catch(error => {
	      console.error('Erreur lors de l\'ajout de le site:', error);
	    });
	  });
	  
	</script>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.4/flowbite.min.js"></script>
	
</body>
</html>